# 串口服务器及传感器硬件配置说明

## 一、硬件准备

### 1、串口服务器

型号：ZLAN5144J

[商品链接](https://detail.tmall.com/item.htm?spm=a230r.1.14.1.6bf010b51dxgHY&id=605631547897&ns=1&abbucket=2)

![ZLAN5144J串口服务器](/aiot/串口服务器.png)

### 2、分贝仪

型号：485（5v供电）

[商品链接](https://item.taobao.com/item.htm?spm=a1z09.2.0.0.52f72e8dak2nBI&id=584593530438&_u=m2rqbr9oc6ee)

![分贝仪](/aiot/分贝仪.png)

### 其他配件

3、485转USB转换器

[商品链接](https://detail.tmall.com/item.htm?id=524739452854&spm=a1z09.2.0.0.52f72e8dak2nBI&_u=m2rqbr9ofd17)

![485转usb转换器](/aiot/485转usb转换器.png)

4、5v电源

5、网线若干

6、交换机或路由器（需要提供给串口服务器和pc同一网段）

## 二、传感器配置

### 1、接线及硬件配置

（1）接usb转换器方式：接线方式：黄线——485A；绿线——485B；红线——＋；黑线——－

（2）开发资料下载：

[下载链接](https://www.prsens.com/index.php?a=shows&catid=45&id=73)

下载完成后安装所需驱动，并打开配置软件，使用485转usb转换器连接电脑即可。

![分贝仪设置](/aiot/分贝仪设置.jpg)

（3）通讯协议示例及解释

举例：

![读取模块噪声值举例](/aiot/读取模块噪声值举例.png)

噪声计算：
当前噪声：02C9（十六进制）=713 → 噪声=71.3dB

（4）主要产品参数：

工作电压：4.5v-5.5v
传输信号：TTL、RS485、模拟量
测量范围：30dB~120dB
响应范围：20HZ~12.5HZ
噪声精度：±0.5dB

### 2、软件及服务配置

（1）通讯基本参数
UART接口或485接口均采用ModBus-RTU协议通信，默认通信通信参数：
波特率∶9600
数据位∶8位
奇偶校验方式∶无校验
停止位长度∶1位
设备ModBus通信地址为：1

（2）数据帧格式定义
采用Modbus-RTU通讯规约，格式如下:
初始结构≥4字节的时间
地址码=1字节
功能码=1字节
数据区=N字节
错误校验=16位CRC码
结束结构≥4字节的时间
地址码:默认01
功能码:主机所发指令功能指示，本模块只用到功能码0x03（读取寄存器数据）
数据区:数据区是具体通讯数据，注意16bits数据高字节在前!
CRC码∶二字节的校验码

![主机问询帧结构](/aiot/主机问询帧结构.png)

![应答模块帧结构](/aiot/应答模块帧结构.png)

![寄存器地址](/aiot/寄存器地址.png)

## 三、串口服务器配置

### 1、接线方式

（1）串口服务器接传感器：

黄色——585T+；绿色——585T-；红色——+；黑色——-（备注：串口服务器不支持5v供电，需要单独外接电源供电，我是用的485转usb连接了正负极插在usb充电口供电，也可以单独外接其它5v供电方式）

（2）串口服务器接pc：

一般来说串口服务器只需要连接电源、串口、网线。
其中电源可以采用现场的2线的的电源，可以直接连接电源正负端子，也可以连接包装中的电源适配器。
其中串口需要根据用户串口设备来连接。将485正接到485A，485负接到485B即可。
网口连接普通网线，可以和计算机直连也可以经过交换机接到网络中。
具体参数详见产品文档。
开发资料下载：
[下载链接](https://www.prsens.com/index.php?a=shows&catid=45&id=73)

### 2、指示灯含义：

Power灯：电源指示灯

Link灯：当网线连接好时Link为绿色。
当TCP连接建立后（或处于UDP模式），Link为蓝色（实际带有微弱的绿色光）。可用于判断串口服务器是否和上位机软件建立通讯链路。

Active灯：当网口向串口发送数据时，指示灯为绿色。闪亮的时间比实际通信时间延后长1秒钟，更方便发现短数据通讯。
当串口向网口发送数据时，指示灯为蓝色和绿色同时亮。由于蓝色比较明亮，所以如果看到蓝色表明存在串口向网口返回数据。这可以判断设备是否有对上位机的命令有响应，如果没有相应则表明串口波特率不对或者串口没有连接好。

### 3、参数配置

（1）软件及驱动安装完毕后，设备硬件连接也完毕后，运行ZLvircom软件如图所示，然后点击“设备管理”如图所示。使用ZLVircom可以在不同的网段内搜索和配置设备参数，非常方便，只要设备和运行ZLVircom的计算机在同一个交换机下就可以。

![ZLVircom主界面](/aiot/ZLVircom主界面.png)

![设备列表](/aiot/设备列表.png)

从设备列表中看到当前所有在线的设备。点击“编辑设备”进行参数的配置。

![设备参数](/aiot/设备参数.png)

在这个界面中，用户可以设定设备的参数，然后点击“修改设置”，则参数被设置到设备的flash中，掉电不丢失。同时设备会自动重启。
这里主要配置的参数有：串口设置中的波特率、数据位、校验位；网络设置中的IP地址、子网掩码、网关；有的时候根据计算机软件，还需要配置串口服务器的工作模式。

接下来进入固件配置中，先创建一个本地根目录用来保存配置参数，然后修改一下设备固定IP地址，接下来需要配置mqtt和json的参数，如图所示。

![固件配置](/aiot/固件配置.png)

mqtt配置中需要填写服务器ip、端口等信息，用于接收传感器获取到的信息，如图所示。

![mqtt配置](/aiot/mqtt配置.png)

json配置分为两步，首先点击json上发设置关键词和modbus-RTU设置，全部设置完成之后点击保存全部并退出。退出之后设置json上发服务器时间等，设置完成之后别忘了点击保存JSON设置。

![json上发](/aiot/json上发.png)

![json配置](/aiot/json配置.png)

设置完成回到固件配置一定要点击下载，将配置烧录到串口服务器中，烧录之后断电也不会清零。

![固件烧录](/aiot/固件烧录.png)
